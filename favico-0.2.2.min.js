/**
 * @license MIT
 * @fileOverview Favico animations
 * @author Miroslav Magda, http://blog.ejci.net
 * @version 0.2.1
 */
!function(){var e=function(e){"use strict";function t(e){if(e.paused||e.ended||y)return!1;try{u.clearRect(0,0,h,a),u.drawImage(e,0,0,h,a)}catch(o){}setTimeout(t,U.duration,e),M.setIcon(c)}function o(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,o,r){return t+t+o+o+r+r});var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:!1}function r(e,t){var o,r={};for(o in e)r[o]=e[o];for(o in t)r[o]=t[o];return r}e=e?e:{};var n,i,a,h,c,u,s,d,l,f,g,y,w,x={bgColor:"#d00",textColor:"#fff",type:"circle",animation:"slide",elementId:!1},m=[];g=function(){},d=y=!1;var p=function(){n=r(x,e),n.bgColor=o(n.bgColor),n.textColor=o(n.textColor),n.animation=U.types[""+n.animation]?n.animation:x.animation,n.type=v[""+n.type]?n.type:x.type;try{i=M.getIcon(),c=document.createElement("canvas"),s=document.createElement("img"),s.setAttribute("src",i.getAttribute("href")),s.onload=function(){a=s.height>0?s.height:32,h=s.width>0?s.width:32,c.height=a,c.width=h,u=c.getContext("2d"),b.ready()},w={},w.ff=/firefox/i.test(navigator.userAgent.toLowerCase()),w.chrome=/chrome/i.test(navigator.userAgent.toLowerCase()),w.opera=/opera/i.test(navigator.userAgent.toLowerCase()),w.ie=/msie/i.test(navigator.userAgent.toLowerCase())||/trident/i.test(navigator.userAgent.toLowerCase()),w.supported=w.chrome||w.ff||w.opera}catch(t){throw"Error initializing favico..."}},b={};b.ready=function(){d=!0,b.reset(),g()},b.reset=function(){m=[],l=!1,u.clearRect(0,0,h,a),u.drawImage(s,0,0,h,a),M.setIcon(c)},b.start=function(){if(d&&!f){var e=function(){l=m[0],f=!1,m.length>0&&(m.shift(),b.start())};m.length>0&&(f=!0,l?U.run(l.options,function(){U.run(m[0].options,function(){e()},!1)},!0):U.run(m[0].options,function(){e()},!1))}};var v={},C=function(e){return e.n=Math.abs(e.n),e.x=h*e.x,e.y=a*e.y,e.w=h*e.w,e.h=a*e.h,e};v.circle=function(e){e=C(e);var t=e.n>9;t&&(e.x=e.x-.4*e.w,e.w=1.4*e.w),u.clearRect(0,0,h,a),u.drawImage(s,0,0,h,a),u.beginPath(),u.font="bold "+Math.floor(e.h)+"px sans-serif",u.textAlign="center",t?(u.moveTo(e.x+e.w/2,e.y),u.lineTo(e.x+e.w-e.h/2,e.y),u.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),u.lineTo(e.x+e.w,e.y+e.h-e.h/2),u.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),u.lineTo(e.x+e.h/2,e.y+e.h),u.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),u.lineTo(e.x,e.y+e.h/2),u.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):u.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),u.fillStyle="rgba("+n.bgColor.r+","+n.bgColor.g+","+n.bgColor.b+","+e.o+")",u.fill(),u.closePath(),u.beginPath(),u.stroke(),u.fillStyle="rgba("+n.textColor.r+","+n.textColor.g+","+n.textColor.b+","+e.o+")",u.fillText(t?"9+":e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),u.closePath()},v.rectangle=function(e){e=C(e);var t=e.n>9;t&&(e.x=Math.floor(e.x-.4*e.w),e.w=Math.floor(1.4*e.w)),u.clearRect(0,0,h,a),u.drawImage(s,0,0,h,a),u.beginPath(),u.font="bold "+Math.floor(e.h)+"px sans-serif",u.textAlign="center",u.fillStyle="rgba("+n.bgColor.r+","+n.bgColor.g+","+n.bgColor.b+","+e.o+")",u.fillRect(e.x,e.y,e.w,e.h),u.fillStyle="rgba("+n.textColor.r+","+n.textColor.g+","+n.textColor.b+","+e.o+")",u.fillText(t?"9+":e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),u.closePath()};var A=function(e,t){g=function(){try{if(e>0){if(U.types[""+t]&&(n.animation=t),m.push({type:"badge",options:{n:e}}),m.length>100)throw"Too many badges requests in queue...";b.start()}else b.reset()}catch(o){throw"Error setting badge..."}},d&&g()},I=function(e){g=function(){try{var t=e.width,o=e.height,r=document.createElement("img"),n=o/a>t/h?t/h:o/a;r.setAttribute("src",e.getAttribute("src")),r.height=o/n,r.width=t/n,u.clearRect(0,0,h,a),u.drawImage(r,0,0,h,a),M.setIcon(c)}catch(i){throw"Error setting image..."}},d&&g()},E=function(e){g=function(){try{if("stop"===e)return y=!0,b.reset(),y=!1,void 0;e.width,e.height,e.addEventListener("play",function(){t(this)},!1)}catch(o){throw"Error setting video..."}},d&&g()},T=function(e){if(window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(e){return e}),w.supported){var o=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,g=function(){try{if("stop"===e)return y=!0,b.reset(),y=!1,void 0;o=document.createElement("video"),o.width=h,o.height=a,navigator.getUserMedia({video:!0,audio:!1},function(e){o.src=URL.createObjectURL(e),o.play(),t(o)},function(){})}catch(r){throw"Error setting webcam..."}},d&&g()}},M={};M.getIcon=function(){var e=!1,t=function(){for(var e=document.getElementsByTagName("head")[0].getElementsByTagName("link"),t=e.length,o=t-1;o>=0;o--)if(/icon/i.test(e[o].getAttribute("rel")))return e[o];return!1};return n.elementId?(e=document.getElementById(n.elementId),e.setAttribute("href",e.getAttribute("src"))):(e=t(),e===!1&&(e=document.createElement("link"),e.setAttribute("rel","icon"),document.getElementsByTagName("head")[0].appendChild(e))),e.setAttribute("type","image/png"),e},M.setIcon=function(e){var t=e.toDataURL("image/png");if(n.elementId)document.getElementById(n.elementId).setAttribute("src",t);else if(w.ff||w.opera){i.getAttribute("rel");var o=i;i=document.createElement("link"),w.opera&&i.setAttribute("rel","icon"),i.setAttribute("rel","icon"),i.setAttribute("type","image/png"),document.getElementsByTagName("head")[0].appendChild(i),i.setAttribute("href",t),o.parentNode&&o.parentNode.removeChild(o)}else i.setAttribute("href",t)};var U={};return U.duration=40,U.types={},U.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],U.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],U.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],U.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],U.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],U.run=function(e,t,o,i){var a=U.types[n.animation];return i=o===!0?"undefined"!=typeof i?i:a.length-1:"undefined"!=typeof i?i:0,t=t?t:function(){},i<a.length&&i>=0?(v[n.type](r(e,a[i])),setTimeout(function(){o?i-=1:i+=1,U.run(e,t,o,i)},U.duration),M.setIcon(c),void 0):(t(),void 0)},p(),{badge:A,video:E,image:I,webcam:T,reset:b.reset}};"undefined"!=typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:this.Favico=e}();